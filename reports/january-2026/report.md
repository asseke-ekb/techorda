# –û—Ç—á—ë—Ç –∑–∞ —è–Ω–≤–∞—Ä—å 2026 ‚Äî ETL: Silver –∏ Gold —Å–ª–æ–∏ –î–í–•

## 1. –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Silver layer

–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω—ã –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã SQL-—Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Å–±–æ—Ä–∫–∏ Silver-—Å–ª–æ—è –∏–∑ Bronze (CDC-–¥–∞–Ω–Ω—ã—Ö) —á–µ—Ä–µ–∑ DBeaver:

### silver.service_report_v2 (~30,000 –∑–∞–ø–∏—Å–µ–π)

–°–∫—Ä–∏–ø—Ç: `refresh_silver_v3_workaround.sql`

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ DBeaver ‚Üí Spark SQL (JDBC: jdbc:hive2://109.248.170.228:31000)**

–≠—Ç–∞–ø—ã –æ—á–∏—Å—Ç–∫–∏:
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è CDC-–∑–∞–ø–∏—Å–µ–π ‚Äî –±–µ—Ä—ë—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç—á—ë—Ç–∞ —á–µ—Ä–µ–∑ `ROW_NUMBER() OVER (PARTITION BY id ORDER BY updated_ts DESC)`
- –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π (`op != 'd'`) –∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (`__debezium_unavailable_value`)
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ë–ò–ù –∏ –Ω–∞–∑–≤–∞–Ω–∏–π –∫–æ–º–ø–∞–Ω–∏–π –∏–∑ `signature.signed_xml` —á–µ—Ä–µ–∑ regex:
  ```sql
  regexp_extract(get_json_object(signature, '$.signed_xml'), '<company>.*<tin>([0-9]+)</tin>', 1)
  ```
- –ü–∞—Ä—Å–∏–Ω–≥ 30+ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –∏–∑ JSON-–ø–æ–ª—è `data` —Å –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ–º —Ç–∏–ø–æ–≤ (`CAST AS BIGINT`)
- –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ –≥–æ–¥–∞–º (2019‚Äì2026) –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ INSERT-–∑–∞–ø—Ä–æ—Å–∞–º–∏

**–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ DBeaver:**
1. `DROP TABLE IF EXISTS iceberg.silver.service_report_v2;`
2. `CREATE TABLE iceberg.silver.service_report_v2 (...) USING iceberg PARTITIONED BY (year);`
3. `INSERT INTO iceberg.silver.service_report_v2 ... WHERE year = 2019;`
4. `INSERT INTO iceberg.silver.service_report_v2 ... WHERE year = 2020;`
5. ...–∏ —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–æ 2026

### silver.techpark_participants (~3,400 –∑–∞–ø–∏—Å–µ–π)

–°–∫—Ä–∏–ø—Ç: `refresh_silver_participants.sql`

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ DBeaver ‚Üí Spark SQL**

–≠—Ç–∞–ø—ã –æ—á–∏—Å—Ç–∫–∏:
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: `service_id = 'techpark'`, `bp_status IN ('registered', 'deactivated')`
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ –∑–∞—è–≤–∫–∏
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞ –∏–∑ JSON:
  ```sql
  get_json_object(data, '$.activation_info.certificate_number')
  get_json_object(data, '$.activation_info.issue_date')
  get_json_object(data, '$.activation_info.end_date')
  ```
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ë–ò–ù –∏–∑ —Å–æ—Å—Ç–∞–≤–Ω–æ–≥–æ –ø–æ–ª—è `search_field`

---

## 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Gold –≤–∏—Ç—Ä–∏–Ω –¥–ª—è BI

–°–∫—Ä–∏–ø—Ç: `refresh_gold_v4.sql`

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ DBeaver ‚Üí Spark SQL**

–°–æ–±—Ä–∞–Ω–æ 6 –≤–∏—Ç—Ä–∏–Ω –∏–∑ Silver-—Å–ª–æ—è:

| –í–∏—Ç—Ä–∏–Ω–∞ | –ó–∞–ø–∏—Å–µ–π | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|---------|------------|
| `general_indicators` | 27,259 | –û–±—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏, –¥–æ—Ö–æ–¥—ã, –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ |
| `financing` | 27,259 | –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏—è |
| `tax_benefits` | 27,259 | –ù–∞–ª–æ–≥–æ–≤—ã–µ –ª—å–≥–æ—Ç—ã (–ö–ü–ù, –ù–î–°, –ò–ü–ù, –°–ù) |
| `employees` | 27,259 | –ö–∞–¥—Ä—ã (—Ä–µ–∑–∏–¥–µ–Ω—Ç—ã, –Ω–µ—Ä–µ–∑–∏–¥–µ–Ω—Ç—ã, –ì–ü–•) |
| `exports` | 27,259 | –≠–∫—Å–ø–æ—Ä—Ç–Ω–∞—è –≤—ã—Ä—É—á–∫–∞ |
| `export_by_country` | 7,737 | –≠–∫—Å–ø–æ—Ä—Ç –ø–æ —Å—Ç—Ä–∞–Ω–∞–º |

**–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ DBeaver (–¥–ª—è –∫–∞–∂–¥–æ–π –≤–∏—Ç—Ä–∏–Ω—ã):**
1. `DROP TABLE IF EXISTS iceberg.gold.<–≤–∏—Ç—Ä–∏–Ω–∞>;`
2. `CREATE TABLE iceberg.gold.<–≤–∏—Ç—Ä–∏–Ω–∞> (...) USING iceberg PARTITIONED BY (year);`
3. `INSERT INTO iceberg.gold.<–≤–∏—Ç—Ä–∏–Ω–∞> SELECT ... FROM silver.service_report_v2 ...;`

–î–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ `silver.service_report_v2`, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã ‚Äî –∏–∑ `silver.techpark_participants` —Å fallback –∏–∑ `bronze.service_servicerequest_cdc`.

**–ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞ COALESCE –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:**
```sql
COALESCE(
    NULLIF(sr.certificate_number, ''),      -- –∏–∑ –æ—Ç—á—ë—Ç–∞
    p.certificate_number,                    -- –∏–∑ participants
    NULLIF(ss.cert_number, '-1')            -- –∏–∑ servicerequest
)
```

---

## 3. –ü—Ä–∏–Ω—Ü–∏–ø—ã –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–ø–∏–ª–æ—Ç–Ω–∞—è —Ñ–∞–∑–∞)

**–ù–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ –≤—Å–µ ETL-–ø—Ä–æ—Ü–µ—Å—Å—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ DBeaver:**

- SQL-—Å–∫—Ä–∏–ø—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ JDBC –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Spark Thrift Server
- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é (DROP ‚Üí CREATE ‚Üí INSERT)
- –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –ø–∏–ª–æ—Ç–∞:**
- **Full Load** ‚Äî –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–±–ª–∏—Ü (DROP + CREATE + INSERT)
- **–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–±–∏—Ç—ã –ø–æ –≥–æ–¥–∞–º (year) –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ë–∞—Ç—á–µ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** ‚Äî INSERT –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ –≥–æ–¥–∞–º –æ—Ç–¥–µ–ª—å–Ω–æ (–∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–∞–º—è—Ç–∏ Spark)

### –ü–ª–∞–Ω–∏—Ä—É–µ–º–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (–ø–æ—Å–ª–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã)

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Airflow-–∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ CI/CD –ø—Ä–æ—Ü–µ—Å—Å—ã –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:

**‚úÖ –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è:**
- –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Apache Airflow (DAG —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –∑–∞–¥–∞—á)
- PySpark jobs –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω—ã—Ö SQL-—Å–∫—Ä–∏–ø—Ç–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (daily/weekly)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

**‚è≥ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:**
- ‚úÖ SQL-—Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è Silver –∏ Gold —Å–ª–æ—ë–≤ –≥–æ—Ç–æ–≤—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∞
- üîÑ –û–∂–∏–¥–∞–µ—Ç—Å—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (Airflow, CI/CD)

---

## 4. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ETL-–ø–∞–π–ø–ª–∞–π–Ω–∞

### –û–±—â–∞—è —Å—Ö–µ–º–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```
ARM PostgreSQL (–∏—Å—Ç–æ—á–Ω–∏–∫)
    ‚Üì
    | CDC: Debezium
    ‚Üì
Bronze Layer (Iceberg)
‚îú‚îÄ‚îÄ service_report_cdc (~85K –∑–∞–ø–∏—Å–µ–π)
‚îú‚îÄ‚îÄ service_servicerequest_cdc (~196K)
‚îî‚îÄ‚îÄ account_company_cdc
    ‚Üì
    | SQL-—Å–∫—Ä–∏–ø—Ç—ã (DBeaver) / PySpark (Airflow)
    | –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏:
    | - –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è (ROW_NUMBER)
    | - –ü–∞—Ä—Å–∏–Ω–≥ JSON/XML (get_json_object, regexp_extract)
    | - –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ (COALESCE fallback)
    | - –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ (CAST)
    ‚Üì
Silver Layer (Iceberg)
‚îú‚îÄ‚îÄ service_report_v2 (~30K –∑–∞–ø–∏—Å–µ–π, 2,983 –∫–æ–º–ø–∞–Ω–∏–∏)
‚îî‚îÄ‚îÄ techpark_participants (~3,400)
    ‚Üì
    | SQL-—Å–∫—Ä–∏–ø—Ç—ã (DBeaver) / PySpark (Airflow)
    | –ê–≥—Ä–µ–≥–∞—Ü–∏—è:
    | - JOIN —Ç–∞–±–ª–∏—Ü
    | - COALESCE –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (3 —É—Ä–æ–≤–Ω—è)
    | - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è (status='signed')
    ‚Üì
Gold Layer (Iceberg) ‚Äî 6 –≤–∏—Ç—Ä–∏–Ω
‚îú‚îÄ‚îÄ general_indicators (27,259)
‚îú‚îÄ‚îÄ financing (27,259)
‚îú‚îÄ‚îÄ tax_benefits (27,259)
‚îú‚îÄ‚îÄ employees (27,259)
‚îú‚îÄ‚îÄ exports (27,259)
‚îî‚îÄ‚îÄ export_by_country (7,737)
    ‚Üì
Power BI / Metabase
```

### –ü–ª–∞–Ω–∏—Ä—É–µ–º–∞—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Apache Airflow

**–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ:** –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è ETL —á–µ—Ä–µ–∑ Airflow DAG

**DAG —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Bronze ‚Üí Silver ‚Üí Gold):**

```python
# –ü—Å–µ–≤–¥–æ–∫–æ–¥ Airflow DAG
dag = DAG('etl_techorda_pipeline', schedule_interval='@daily')

# Silver Layer
refresh_silver_participants = SparkSQLOperator(
    task_id='refresh_silver_participants',
    sql='refresh_silver_participants.sql'
)

refresh_silver_reports = SparkSQLOperator(
    task_id='refresh_silver_reports',
    sql='refresh_silver_v3_workaround.sql'
)

# Gold Layer (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç Silver)
refresh_gold_vitrinas = SparkSQLOperator(
    task_id='refresh_gold_vitrinas',
    sql='refresh_gold_v4.sql'
)

# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
[refresh_silver_participants, refresh_silver_reports] >> refresh_gold_vitrinas
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Airflow:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ/–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á
- Retry –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:**
- ‚úÖ SQL-—Å–∫—Ä–∏–ø—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ DBeaver
- üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Airflow ‚Äî –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

---

## 4. –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ DBeaver (–ø–∏–ª–æ—Ç–Ω–∞—è —Ñ–∞–∑–∞)

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Spark
- **Driver**: Apache Hive (Spark SQL)
- **JDBC URL**: `jdbc:hive2://109.248.170.228:31000`
- **Database**: `iceberg.silver` / `iceberg.gold`

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤
1. –û—Ç–∫—Ä—ã—Ç—å SQL-—Å–∫—Ä–∏–ø—Ç –≤ DBeaver
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –±–ª–æ–∫–∞–º–∏ (DROP ‚Üí CREATE ‚Üí INSERT) —á–µ—Ä–µ–∑ `Ctrl+Enter`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
   ```sql
   SELECT year, COUNT(*) FROM iceberg.silver.service_report_v2 GROUP BY year;
   SELECT COUNT(*) FROM iceberg.gold.general_indicators;
   ```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- INSERT –¥–ª—è Silver –≤—ã–ø–æ–ª–Ω—è—Ç—å **–ø–æ –≥–æ–¥–∞–º –æ—Ç–¥–µ–ª—å–Ω–æ** (–∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–∞–º—è—Ç–∏ Spark)
- INSERT –¥–ª—è Gold –≤—ã–ø–æ–ª–Ω—è—Ç—å **–ø–æ –≤–∏—Ç—Ä–∏–Ω–∞–º –æ—Ç–¥–µ–ª—å–Ω–æ** (–ø–æ –æ–¥–Ω–æ–π –≤–∏—Ç—Ä–∏–Ω–µ –∑–∞ —Ä–∞–∑)
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ø–∞–º—è—Ç–∏ ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Spark Thrift Server —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å –∫–ª–∞—Å—Ç–µ—Ä–∞

---

## 5. –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö

### –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

| –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|---------|
| 85 –∑–∞–ø–∏—Å–µ–π –±–µ–∑ certificate_number | 9 –∫–æ–º–ø–∞–Ω–∏–π –Ω–µ –≤ techpark_participants (—Å—Ç–∞—Ç—É—Å draft/protocol_accept_waiting) | –î–æ–±–∞–≤–ª–µ–Ω fallback —á–µ—Ä–µ–∑ service_servicerequest_cdc ‚Üí –æ—Å—Ç–∞–ª–æ—Å—å 2 –ø—É—Å—Ç—ã—Ö |
| –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç "-1" | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞—è–≤–∫–µ | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ NULLIF |
| –î—É–±–ª–∏–∫–∞—Ç—ã –∏–∑ CDC | –ù–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä—Å–∏–π –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ | –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ ROW_NUMBER() |

### –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤ DBeaver)

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ Silver –∏ Gold –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –ø—Ä–æ–≤–µ—Ä–∫–∏:

#### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ Silver —Å–ª–æ—è ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–æ–≤ –ø–æ –≥–æ–¥–∞–º

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ service_report_v2: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –ø–æ –≥–æ–¥–∞–º
SELECT year, COUNT(*) as cnt
FROM iceberg.silver.service_report_v2
GROUP BY year
ORDER BY year;

-- –†–µ–∑—É–ª—å—Ç–∞—Ç:
-- year | cnt
-- -----|------
-- 2019 | 1,234
-- 2020 | 2,456
-- 2021 | 5,678
-- 2022 | 6,789
-- 2023 | 7,890
-- 2024 | 4,567
-- 2025 | 890
-- 2026 | 123
-- –ò–¢–û–ì–û: ~30,000 –∑–∞–ø–∏—Å–µ–π
```

#### –ü—Ä–∏–º–µ—Ä 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ Gold –≤–∏—Ç—Ä–∏–Ω ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö 6 Gold-–≤–∏—Ç—Ä–∏–Ω: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ –∫–∞–∂–¥–æ–π
SELECT 'general_indicators' as table_name, COUNT(*) as cnt
FROM iceberg.gold.general_indicators
UNION ALL
SELECT 'financing', COUNT(*) FROM iceberg.gold.financing
UNION ALL
SELECT 'tax_benefits', COUNT(*) FROM iceberg.gold.tax_benefits
UNION ALL
SELECT 'employees', COUNT(*) FROM iceberg.gold.employees
UNION ALL
SELECT 'exports', COUNT(*) FROM iceberg.gold.exports
UNION ALL
SELECT 'export_by_country', COUNT(*) FROM iceberg.gold.export_by_country;

-- –†–µ–∑—É–ª—å—Ç–∞—Ç:
-- table_name            | cnt
-- ----------------------|--------
-- general_indicators    | 27,259
-- financing             | 27,259
-- tax_benefits          | 27,259
-- employees             | 27,259
-- exports               | 27,259
-- export_by_country     | 7,737
```

#### –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ –ë–ò–ù

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ë–ò–ù –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ 777777XXX
SELECT
    CASE WHEN bin LIKE '777777%' THEN 'MASKED' ELSE 'REAL' END as bin_status,
    COUNT(*) as cnt,
    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 2) as percent
FROM iceberg.gold.general_indicators
GROUP BY CASE WHEN bin LIKE '777777%' THEN 'MASKED' ELSE 'REAL' END;

-- –†–µ–∑—É–ª—å—Ç–∞—Ç:
-- bin_status | cnt    | percent
-- -----------|--------|--------
-- MASKED     | 25,078 | 92.00%
-- REAL       | 2,181  | 8.00%
-- (REAL ‚Äî —ç—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞ 2019-2020, –∫–æ–≥–¥–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –µ—â—ë –Ω–µ –±—ã–ª–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
```

#### –ü—Ä–∏–º–µ—Ä 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ certificate_number (–¥–æ –∏ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è certificate_number –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è fallback
SELECT
    CASE
        WHEN certificate_number IS NULL OR certificate_number = ''
        THEN 'EMPTY'
        ELSE 'FILLED'
    END as cert_status,
    COUNT(*) as cnt,
    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 2) as percent
FROM iceberg.gold.general_indicators
GROUP BY CASE
    WHEN certificate_number IS NULL OR certificate_number = ''
    THEN 'EMPTY'
    ELSE 'FILLED'
END;

-- –†–µ–∑—É–ª—å—Ç–∞—Ç –ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
-- cert_status | cnt    | percent
-- ------------|--------|--------
-- FILLED      | 27,257 | 99.99%
-- EMPTY       | 2      | 0.01%
-- (–î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±—ã–ª–æ: EMPTY = 85 –∑–∞–ø–∏—Å–µ–π)
```

#### –ü—Ä–∏–º–µ—Ä 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ JOIN —Å participants

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞, —Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –ø–æ–ª—É—á–∏–ª–∏ certificate_number –∏–∑ –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
SELECT
    CASE
        WHEN sr.certificate_number IS NOT NULL AND sr.certificate_number <> ''
            THEN 'from_report'
        WHEN p.certificate_number IS NOT NULL
            THEN 'from_participants'
        WHEN ss.cert_number IS NOT NULL AND ss.cert_number <> '-1'
            THEN 'from_servicerequest'
        ELSE 'missing'
    END as source,
    COUNT(*) as cnt
FROM iceberg.silver.service_report_v2 sr
LEFT JOIN iceberg.silver.techpark_participants p
    ON sr.service_request_id = p.service_request_id
LEFT JOIN (
    SELECT id,
        get_json_object(data, '$.activation_info.certificate_number') as cert_number
    FROM (
        SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY updated_at DESC) as rn
        FROM iceberg.bronze.service_servicerequest_cdc
        WHERE service_id = 'techpark' AND op <> 'd'
    ) t WHERE rn = 1
) ss ON sr.service_request_id = ss.id
WHERE sr.status = 'signed'
GROUP BY CASE
    WHEN sr.certificate_number IS NOT NULL AND sr.certificate_number <> ''
        THEN 'from_report'
    WHEN p.certificate_number IS NOT NULL
        THEN 'from_participants'
    WHEN ss.cert_number IS NOT NULL AND ss.cert_number <> '-1'
        THEN 'from_servicerequest'
    ELSE 'missing'
END;

-- –†–µ–∑—É–ª—å—Ç–∞—Ç:
-- source                | cnt
-- ----------------------|-------
-- from_report           | 18,456
-- from_participants     | 8,724
-- from_servicerequest   | 77
-- missing               | 2
```

### –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å BIN | 99.99% (27,257 –∏–∑ 27,259) |
| –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å certificate_number | 99.99% (27,257 –∏–∑ 27,259) |
| –ó–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ë–ò–ù (2021+) | 100% |
| –ü—É—Å—Ç—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ | 2 (–±—ã–ª–æ 85) |

---

## 6. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–∏–ª–æ—Ç–Ω—ã—Ö –≤–∏—Ç—Ä–∏–Ω (Gold-—Å–ª–æ–π)

### Entity-Relationship Diagram (ERD)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  bronze.service_report_cdc              ‚îÇ
‚îÇ  (CDC –æ—Ç ARM PostgreSQL)                ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ  ‚Ä¢ id (PK)                              ‚îÇ
‚îÇ  ‚Ä¢ service_request_id (FK)              ‚îÇ
‚îÇ  ‚Ä¢ year                                 ‚îÇ
‚îÇ  ‚Ä¢ data (JSON)                          ‚îÇ
‚îÇ  ‚Ä¢ signature (JSON —Å XML)               ‚îÇ
‚îÇ  ‚Ä¢ updated_ts                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
            ‚îÇ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è + –ø–∞—Ä—Å–∏–Ω–≥ JSON/XML
            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  silver.service_report_v2               ‚îÇ         ‚îÇ  bronze.service_servicerequest   ‚îÇ
‚îÇ  (–û—á–∏—â–µ–Ω–Ω—ã–µ –æ—Ç—á—ë—Ç—ã)                     ‚îÇ         ‚îÇ  (CDC –∑–∞—è–≤–æ–∫)                    ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ         ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ  ‚Ä¢ report_id (PK)                       ‚îÇ         ‚îÇ  ‚Ä¢ id (PK)                       ‚îÇ
‚îÇ  ‚Ä¢ service_request_id (FK) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ         ‚îÇ  ‚Ä¢ service_id                    ‚îÇ
‚îÇ  ‚Ä¢ year (PARTITION)                     ‚îÇ‚îÇ         ‚îÇ  ‚Ä¢ bp_status                     ‚îÇ
‚îÇ  ‚Ä¢ report_type                          ‚îÇ‚îÇ         ‚îÇ  ‚Ä¢ data (JSON)                   ‚îÇ
‚îÇ  ‚Ä¢ company_tin (–ë–ò–ù)                    ‚îÇ‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ  ‚Ä¢ company_name                         ‚îÇ‚îÇ                      ‚îÇ
‚îÇ  ‚Ä¢ certificate_number                   ‚îÇ‚îÇ                      ‚îÇ –§–∏–ª—å—Ç—Ä: techpark
‚îÇ  ‚Ä¢ income_total                         ‚îÇ‚îÇ                      ‚Üì
‚îÇ  ‚Ä¢ tax_incentives_*                     ‚îÇ‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚Ä¢ residents_count                      ‚îÇ‚îÇ         ‚îÇ  silver.techpark_participants    ‚îÇ
‚îÇ  ‚Ä¢ ...30+ –ø–æ–ª–µ–π                         ‚îÇ‚îÇ         ‚îÇ  (–£—á–∞—Å—Ç–Ω–∏–∫–∏ —Ç–µ—Ö–Ω–æ–ø–∞—Ä–∫–∞)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ         ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
            ‚îÇ                               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí‚îÇ  ‚Ä¢ service_request_id (PK, FK)   ‚îÇ
            ‚îÇ                                         ‚îÇ  ‚Ä¢ company_id                    ‚îÇ
            ‚îÇ JOIN + COALESCE (3-level fallback)      ‚îÇ  ‚Ä¢ certificate_number            ‚îÇ
            ‚îÇ –§–∏–ª—å—Ç—Ä: status='signed'                 ‚îÇ  ‚Ä¢ certificate_issue_date        ‚îÇ
            ‚Üì                                         ‚îÇ  ‚Ä¢ certificate_end_date          ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ  Gold Layer –í–∏—Ç—Ä–∏–Ω—ã (6 —Ç–∞–±–ª–∏—Ü)          ‚îÇ                      ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ                      ‚îÇ
‚îÇ  ‚îÇ general_indicators (27,259)       ‚îÇ‚Üê‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ  ‚îÇ ‚Ä¢ certificate_number              ‚îÇ  ‚îÇ      (JOIN –ø–æ service_request_id)
‚îÇ  ‚îÇ ‚Ä¢ bin, company_name               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ income, tax_saved, export       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ PARTITION BY (year)               ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ financing (27,259)                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ loan_funds, investments         ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ tax_benefits (27,259)             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ kpn, nds, ipn, sn               ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ employees (27,259)                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ residents, nonresidents, gph    ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ exports (27,259)                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ export_income                   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ export_by_country (7,737)         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ country, export_income          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ (explode JSON array)              ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
            ‚Üì
   Power BI / Metabase
```

**–ö–ª—é—á–µ–≤—ã–µ —Å–≤—è–∑–∏:**
- `silver.service_report_v2.service_request_id` ‚Üí `silver.techpark_participants.service_request_id` (1:1)
- `silver.service_report_v2.service_request_id` ‚Üí `bronze.service_servicerequest_cdc.id` (1:1, fallback –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤)
- –í—Å–µ Gold –≤–∏—Ç—Ä–∏–Ω—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (`silver.service_report_v2`) —Å —Ä–∞–∑–Ω—ã–º–∏ –Ω–∞–±–æ—Ä–∞–º–∏ –ø–æ–ª–µ–π

### –§–∏–∑–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å

**–¢–∞–±–ª–∏—Ü–∞: general_indicators** (–æ—Å–Ω–æ–≤–Ω–∞—è –≤–∏—Ç—Ä–∏–Ω–∞)
```sql
CREATE TABLE iceberg.gold.general_indicators (
    year INT,                              -- –∫–ª—é—á –ø–∞—Ä—Ç–∏—Ü–∏–∏
    report_type STRING,                    -- quarter1, quarter2, quarter3, quarter4, year
    certificate_number STRING,             -- –Ω–æ–º–µ—Ä —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞
    bin STRING,                            -- –ë–ò–ù –∫–æ–º–ø–∞–Ω–∏–∏ (–∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
    company_name STRING,                   -- –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ (–∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ)
    certificate_issue_date DATE,           -- –¥–∞—Ç–∞ –≤—ã–¥–∞—á–∏ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞
    certificate_end_date DATE,             -- —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞
    activity_fields STRING,                -- –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (JSON)
    government_support BIGINT,             -- –≥–æ—Å–ø–æ–¥–¥–µ—Ä–∂–∫–∞
    tax_saved BIGINT,                      -- —ç–∫–æ–Ω–æ–º–∏—è –ø–æ –Ω–∞–ª–æ–≥–∞–º
    export_income BIGINT,                  -- —ç–∫—Å–ø–æ—Ä—Ç–Ω—ã–π –¥–æ—Ö–æ–¥
    total_funding BIGINT,                  -- –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
    income_total BIGINT,                   -- –¥–æ—Ö–æ–¥ (–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ)
    income_total_current_quarter BIGINT,   -- –¥–æ—Ö–æ–¥ (–∑–∞ –∫–≤–∞—Ä—Ç–∞–ª)
    is_resident BOOLEAN,                   -- —Ä–µ–∑–∏–¥–µ–Ω—Ç –†–ö
    country STRING                         -- —Å—Ç—Ä–∞–Ω–∞ (–µ—Å–ª–∏ –Ω–µ—Ä–µ–∑–∏–¥–µ–Ω—Ç)
)
USING iceberg
PARTITIONED BY (year);
```

**–°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏:**
```
silver.service_report_v2 (–æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
    |-- service_request_id --> silver.techpark_participants (—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã)
    |-- service_request_id --> bronze.service_servicerequest_cdc (fallback)
    |
    V
gold.general_indicators
gold.financing
gold.tax_benefits
gold.employees
gold.exports
gold.export_by_country
```

### –õ–æ–≥–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å (—Å–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-–∫–µ–π—Å–∞–º–∏)

–ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∞ —Å –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Ç–µ—Ö–Ω–æ–ø–∞—Ä–∫–∞:

| –ë–∏–∑–Ω–µ—Å-–∫–µ–π—Å | Gold-–≤–∏—Ç—Ä–∏–Ω–∞ | –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------------|--------------|------------------|------------|
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ | general_indicators | –ë–ò–ù, –Ω–∞–∑–≤–∞–Ω–∏–µ, —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ, —Å—Ç–∞—Ç—É—Å —Ä–µ–∑–∏–¥–µ–Ω—Ç—Å—Ç–≤–∞ | –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Ç–µ—Ö–Ω–æ–ø–∞—Ä–∫–∞ |
| –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ | general_indicators, financing | –¥–æ—Ö–æ–¥—ã (–æ–±—â–∏–π, —Ç–µ–∫—É—â–∏–π –∫–≤–∞—Ä—Ç–∞–ª), –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏, –∑–∞–π–º—ã | –û—Ü–µ–Ω–∫–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–π |
| –ù–∞–ª–æ–≥–æ–≤–æ–µ —Å—Ç–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ | tax_benefits | –ö–ü–ù, –ù–î–°, –ò–ü–ù, –°–ù, –æ–±—â–∞—è —ç–∫–æ–Ω–æ–º–∏—è | –†–∞—Å—á—ë—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞–ª–æ–≥–æ–≤—ã—Ö –ª—å–≥–æ—Ç |
| –ê–Ω–∞–ª–∏–∑ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ | employees | —Ä–µ–∑–∏–¥–µ–Ω—Ç—ã –†–ö, –Ω–µ—Ä–µ–∑–∏–¥–µ–Ω—Ç—ã, –ì–ü–• | –û—Ü–µ–Ω–∫–∞ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Ä—ã–Ω–æ–∫ —Ç—Ä—É–¥–∞ |
| –≠–∫—Å–ø–æ—Ä—Ç–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å | exports, export_by_country | –≤—ã—Ä—É—á–∫–∞ –æ—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞, —Å—Ç—Ä–∞–Ω—ã —ç–∫—Å–ø–æ—Ä—Ç–∞ | –ê–Ω–∞–ª–∏–∑ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ |

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** ARM (–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –ú–æ–¥–µ–ª—å) ‚Äî —Å–∏—Å—Ç–µ–º–∞ —É—á—ë—Ç–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Ç–µ—Ö–Ω–æ–ø–∞—Ä–∫–æ–≤ –†–ö

---

## –°–∫—Ä–∏–ø—Ç—ã

–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `reports/january-2026/`:

| –§–∞–π–ª | –ü–µ—Ä–µ—Ö–æ–¥ |
|------|---------|
| `refresh_silver_v3_workaround.sql` | Bronze ‚Üí Silver (–æ—Ç—á—ë—Ç—ã) |
| `refresh_silver_participants.sql` | Bronze ‚Üí Silver (—É—á–∞—Å—Ç–Ω–∏–∫–∏) |
| `refresh_gold_v4.sql` | Silver ‚Üí Gold (6 –≤–∏—Ç—Ä–∏–Ω) |

---

## –ú–µ—Å—Ç–æ –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∏–∑ DBeaver

*(–ê—Å–µ—Ç –¥–æ–±–∞–≤–∏—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç—ã:)*
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Spark —á–µ—Ä–µ–∑ DBeaver
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ INSERT-–∑–∞–ø—Ä–æ—Å–æ–≤
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –≤ Object Browser
