# Шпаргалка для Zoom — DWH Techorda

---

## Если спросят: "Что сделано?"

**Короткий ответ:**
> Собрали Silver и Gold слои для пилота ARM. 6 витрин готовы для Power BI. Скрипты написаны и протестированы через DBeaver.

**Подробнее:**
- Bronze слой уже был (CDC через Debezium)
- Я собрал **Silver слой** — 2 таблицы:
  - `service_report_v2` (~30K записей) — отчёты участников
  - `techpark_participants` (~3,400) — участники технопарка
- Из Silver собрал **Gold слой** — 6 витрин:
  - general_indicators, financing, tax_benefits, employees, exports, export_by_country
  - Каждая по ~27K записей
- Решил проблему с пустыми сертификатами (было 85 пустых → стало 2)

---

## Если спросят: "Какие трансформации делались?"

> В Silver: дедупликация CDC-записей, парсинг JSON и XML для извлечения БИН и названий компаний, приведение типов.
> В Gold: JOIN таблиц, трёхуровневый fallback для certificate_number через COALESCE, фильтрация по статусу signed.

**Ключевые моменты:**
- ROW_NUMBER() для дедупликации (берём последнюю версию записи)
- regexp_extract для парсинга XML (извлечение БИН из signed_xml)
- COALESCE на 3 уровня: отчёт → participants → servicerequest
- Данные замаскированы (БИН: 777777xxx) — маскирование было настроено в Debezium

---

## Если спросят: "Сколько таблиц в ARM?"

> **157 таблиц**, 26 модулей. Основные для аналитики:
> - **service** — 34 таблицы (основной модуль, отчёты и заявки)
> - **core** — 27 таблиц (события, вакансии, блоги)
> - **account** — 16 таблиц (пользователи, компании)
> - **techorda** — 7 таблиц (образовательные программы)

Детально расписано в Excel файле (systems_integration.xlsx)

---

## Если спросят: "Как запускается ETL?"

**Сейчас (пилот):**
> Вручную через DBeaver. Подключение к Spark Thrift Server по JDBC. Выполняю SQL скрипты блоками: DROP → CREATE → INSERT по годам.

**Планируется:**
> Автоматизация через Airflow. DAG с зависимостями: сначала Silver (2 таска параллельно), потом Gold. SQL скрипты уже готовы, ждём инфраструктуру.

---

## Если спросят: "Какая модель данных?"

> Медальонная архитектура: Bronze → Silver → Gold. Всё на Apache Iceberg с партиционированием по годам.

**Физическая модель:**
- Bronze: CDC таблицы (сырые данные из PostgreSQL)
- Silver: очищенные, дедуплицированные таблицы
- Gold: 6 витрин для BI (каждая под свой бизнес-кейс)

**Логическая модель (бизнес-кейсы):**
- Мониторинг участников → general_indicators
- Финансовый анализ → financing
- Налоговые льготы → tax_benefits
- Занятость → employees
- Экспорт → exports, export_by_country

---

## Если спросят: "Что по качеству данных?"

> Заполненность БИН — 99.99%, сертификатов — 99.99%. Маскировка данных 100% для записей с 2021 года.

| Метрика | Значение |
|---------|----------|
| Заполненность BIN | 99.99% |
| Заполненность certificate | 99.99% |
| Маскировка (2021+) | 100% |
| Пустых сертификатов | 2 из 27,259 |

---

## Если спросят: "Что блочит другие системы?"

| Система | Что блочит |
|---------|-----------|
| **Techpreneurs** | API не готов, ждём реализацию от поставщика |
| **Documentolog** | API не готов, ждём реализацию от поставщика |
| **Mitwork** | API не готов, ждём реализацию от AstanaHub |
| **Aiokk** | Не ясно, внедрена ли система вообще |
| **1C УХ** | Риски по срокам, система может быть не готова |
| **Alaqan** | Нет документации API, ждём BRD |
| **AmoCRM** | Ждём BRD, нужен API ключ |

**Системы без блокеров (API доступны):**
Notion, Google Disk, Noco DB, Telegram, Google Analytics, Яндекс Метрика, Jira, Confluence

---

## Что спросить на зуме (вопросы от тебя):

### По инфраструктуре:
1. **"Когда будет готов Production кластер?"** — сейчас всё на dev
2. **"Когда подготовят Airflow?"** — SQL скрипты готовы, нужна инфраструктура для автоматизации
3. **"Нужен ли отдельный Spark кластер для Gold или используем текущий?"**

### По доступам и системам:
4. **"По Alaqan — кто даст документацию API? Когда?"**
5. **"По AmoCRM — кто даст API ключ?"**
6. **"Aiokk — система вообще внедрена? С кем уточнять?"**
7. **"Techpreneurs и Documentolog — какие сроки по готовности API от поставщиков?"**
8. **"Mitwork — кто отвечает за реализацию API?"**

### По задачам:
9. **"Bronze → Silver → Gold для ARM готово. Какой следующий источник в приоритете?"**
10. **"Нужно ли расширять витрины ARM (добавить core, techorda модули) или переходим к другим системам?"**
11. **"Кто будет делать Silver → Gold для не-ARM систем? Мы или команда DWH?"** (в таблице стоят ????)

### По отчётности:
12. **"Какие скриншоты нужны для отчёта? Только DBeaver?"**
13. **"Отчёт за январь — в каком формате сдавать? MD/DOCX/PDF?"**

---

## Цифры наизусть (если спросят):

| Что | Число |
|-----|-------|
| Таблиц в ARM | 157 |
| Модулей в ARM | 26 |
| Записей в Bronze (reports) | ~85K |
| Записей в Silver (reports) | ~30K |
| Записей в Gold (витрины) | 27,259 |
| Gold витрин | 6 |
| Компаний в данных | 2,983 |
| Участников технопарка | ~3,400 |
| Годы данных | 2019-2026 |
| Всего систем для интеграции | 17 |

---

## Технический стек (если спросят):

- **Источник:** ARM PostgreSQL
- **CDC:** Debezium → Kafka → Bronze
- **Хранилище:** Apache Iceberg (S3-совместимое)
- **Движок:** Apache Spark SQL
- **IDE:** DBeaver (JDBC: jdbc:hive2://109.248.170.228:31000)
- **Оркестрация (план):** Apache Airflow
- **BI:** Power BI, Metabase
- **Партиционирование:** по year
